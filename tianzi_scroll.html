<!DOCTYPE html>
<html>

<head>
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.js"></script>
    <style type="text/css">
    * {
        padding: 0;
        margin: 0;
    }

    .scrollBox {
        width: 100vw;
        overflow-x: hidden;
    }

    .wrapper {
        margin: 8vw;
        width: 84vw;
        /* overflow: hidden; */
        overflow-x: hidden;
    }

    .scroller {
        width: 345vw;
        position: relative;
    }

    .item {
        display: inline-block;
        height: 12vw;
        width: 12vw;
        border: 1px solid gray;
        border-right: none;
        /*float: right;*/
    }

    .flowView {
        height: 12vw;
        width: 12vw;
        border: 1px solid red;
        position: absolute;
        left: 0;
        top: 0;
    }

    .nextBtn {
        background: pink;
        padding: 20vw;
        margin: 0 auto;
        margin-top: 50vw;
        text-align: center;
    }
    </style>
</head>

<body>
    <div id="app">
        <div class="scrollBox">
            <div id="wrapper" class="wrapper">
                <div class="scroller" id="scroller">
                    <div class="item" v-for="n in 25">{{n}}</div>
                    <div class="flowView"></div>
                </div>
            </div>
        </div>
        <div class="nextBtn" id="nextBtn">下一个</div>
    </div>
    <script type="text/javascript">
    var app = new Vue({
        el: "#app",
        data: {},
        methods: {

        }
    })

    var startX;
    var startTime;
    var endTime;
    var minV = 300; // 最小滑动速度
    var minX = 150; // 最小滑动距离
    var leftEdge = $("#wrapper").offset().left;


    var itemPageNum = 5; //滚动一屏item的数量
    var itemSize = 25; //25个格子

    var scrollPageIndex = 0; // 当前滑动到第几屏
    var scrollItemIndex = 0; //当前选择框位置 
    var scrollPageWidth = $(".item").eq(0).width() * itemPageNum + itemPageNum; //每次滑动的宽度
    var pageSize = itemSize / itemPageNum - 1;

    $("#scroller").on('touchstart', function(e) {
        startTime = new Date().getTime();
        startX = e.touches[0].clientX;
        console.log(startTime);
    })

    $("#scroller").on('touchmove', function(e) {
        //set({ left: offsetX + distanceX });
        // moveX = e.touches[0].clientX;
    })
    $("#scroller").on('touchend', function(e) {
        var endX = e.changedTouches[0].clientX;
        var distanceX = endX - startX;
        endTime = new Date().getTime();
        var velocity = distanceX / ((endTime - startTime) / 1000);
        velocity = Math.abs(velocity);
        // 根据速度判断滑动
        if (velocity > minV && distanceX > minX) {
            if (scrollPageIndex == 0) {
                return;
            }
            scrollPageIndex--;
            var currentOffset = $("#scroller").offset().left;
            $("#scroller").offset({ left: 1 * scrollPageWidth + currentOffset });
        } else if (velocity > minV && distanceX < -1 * minX) {
            //从右向左滑动
            if (scrollPageIndex == pageSize) {
                return;
            }
            scrollPageIndex++;
            var currentOffset = $("#scroller").offset().left;
            $("#scroller").offset({ left: -1 * scrollPageWidth + currentOffset });
        }

    })

    $("#nextBtn").click(function() {
        if (scrollItemIndex >= itemSize - 1) {
            // 最后一页
            if (scrollPageIndex != pageSize) {
                scrollPageIndex = pageSize;
                $("#scroller").offset({ left: -1 * scrollPageWidth * scrollPageIndex + leftEdge });
            }
        } else {
            scrollItemIndex++; //高亮的格子

            //滚动页面
            var needScrollPageIndex = Math.floor(scrollItemIndex / itemPageNum);
            if (needScrollPageIndex <= pageSize) {
                scrollPageIndex = needScrollPageIndex;
                $("#scroller").offset({ left: -1 * scrollPageWidth * scrollPageIndex + leftEdge });
            }
            //滚动选择框
            var currentItemLeft = $(".item").eq(scrollItemIndex).offset().left;
            $(".flowView").eq(0).offset({ left: currentItemLeft })
        }

    })

    $(".item").each(function(index) {
        $(this).click(function() {
            scrollItemIndex=index; //高亮的格子
            //滚动页面
            var needScrollPageIndex = Math.floor(scrollItemIndex / itemPageNum);
            if (needScrollPageIndex <= pageSize) {
                scrollPageIndex = needScrollPageIndex;
                $("#scroller").offset({ left: -1 * scrollPageWidth * scrollPageIndex + leftEdge });
            }
            //滚动选择框
            var currentItemLeft = $(".item").eq(scrollItemIndex).offset().left;
            $(".flowView").eq(0).offset({ left: currentItemLeft })
        })
    })
    </script>
</body>

</html>